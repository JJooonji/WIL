# 2022.09.11의 WIL

## 항해99 실전프로젝트 2주

<br>

### 실전프로젝트 2주
#### - 실전프로젝트 2주차!!
#### - 이번 주차는 기본 기능 구현 후 추가 기능들을 구현해보는 주차였다~!
#### - 먼저 https 서버 배포를 위한 환경을 만들어주고자 했다~
#### -  https서버 구축을 위한 방법으로 letsencrypt와 nginx 두가지를 알게되었다~!
#### - 먼저 두가지 방법을 검색헤보았고, 검색해서 나온 방법을 통해 nginx를 이용한 https 서버를 구축하려고 하였다.
#### - 블로그들을 비교하면서 명령어들을 비교하며 우리 조의 ubuntu에 명령어를 작성하며 시작해나갔다~!
#### - 차근차근 명령어들을 입력하며 도메인 정보와 이메일 정보를 입력하였는데..! 에러들이 발생하였다..
#### - `certbot: error: unrecognized arguments: -email`에러ㅠ
#### -  해당 에러를 검색해보니 버전의 문제라는 이야기도 있어 upgrade도 다시 해주었지만, 해결이 되지 않았다ㅠ
#### - 그 후 다시 에러를 검색해나가다 보니 오타 또는 따옴표의 문제일 수도 있다는 글을 보았고, 처음부터 한글자씩 살펴보며 오타 점검도 하였고, 따옴표나 특수문자가 갑자기 들어간 곳도 있나 다시 살펴보았다.
#### - 하지만 오류를 찾을 수 없었고, 다시 처음부터 새로운 마음으로 시도를 해도 구현되지 않았다..
#### - 그래서 우리 백엔드 팀에 자문을 구했고, 팀 리더님께서는 nginx가 아닌 letsencrypt로 https 서버를 구축하셨다고 하였다.
#### - 일단 https 서버가 잘 되는지 확인하여 프론트와 연결을 해보는 것이 중요했기에! letsencrypt로 노선을 변경하였다!
#### - 다시 구글링을 하여 정리가 잘 되어있는 블로그를 찾아서 처음부터 시도해보았다!
#### - 오!! 이 방법은 인증서도 잘 발급되고 ubuntu와 ec2설정까지 잘 완료되었다!!
#### - 하지만.. vscode에 인증서 경로 등 코드를 넣었는데 서버가 돌아가질 않았다..ㅠ
#### - 우리 조 리더에게 자문을 구하고, 같이 코드를 보면서 이야기를 나누었고!! 드디어 해결이 되었다..
#### - 코드 가장 하단에 listen(port) - 웹소켓코드 - http/https listen의 순서대로 코드를 작성하였는데, port 코드를 주석처리한 후 http/https listen 코드를 살려서 서버를 돌리니 웹소켓에서 받는 server가 port server로 연결되어 있어 그 아래에 있는 http/https listen까지 가지 못했고, http/https listen 쪽에 웹소켓으로 이어주는 server코드가 없었던 것이 문제였다..
```
1. 문제가 생겼던 코드의 순서

//const server = app.listen(port, () => {
//  console.log(port, '포트로 서버가 열렸어요!');
//});

webSocket(server, app);

//프론트 서버 오픈시 같이 오픈
http.createServer(app).listen(3000);
https.createServer(options, app).listen(443);
```

```
2. 해결된 코드의 순서

//const server = app.listen(port, () => {
//  console.log(port, '포트로 서버가 열렸어요!');
//});

//프론트 서버 오픈시 같이 오픈
http.createServer(app).listen(3000);
const server = https.createServer(options, app).listen(443);

webSocket(server, app);
```
#### - 문제를 확인하고 2번과 같이 코드를 수정하니 https가 잘 구동되었고, 그 후 이번주차 말에 프론트 서버와 연결해볼 수 있었다~!
#### - 처음 시도했던 방법은 비록 실패하였지만, 다른 방법을 통해 구현해낼 수 있었고, 그 안에서 발생한 코드 순서 및 연결 코드들에 대한 오류를 통해 코드 흐름에 대한 중요성을 다시 상기시킬 수 있었다~!
#### `다음엔 nginx 방법도 다시 시도해봐야지!!`




<br>

#### - https 서버 구축을 마친 이후에는 팀에서 조금 뒤로 미뤄놓았던 작은 기능들을 구현했다.
#### - 먼저 닉네임 수정! 카카오 및 구글로 소셜로그인을 할 시 유저가 해당 프로그램들에서 미리 지정해놓았던 닉네임이 그대로 디비에 저장이 되는데, 우리가 기획하는 프로젝트의 특성상 개인적인 고민을 나누기도 하기때문에 닉네임이 익명이 되는 것이 유저의 사생활을 지켜줄 수 있을 것이라 생각했다.
#### - 그래서 마이페이지 쪽에 닉네임 수정 api를 만들어 유저가 닉네임을 수정할 수 있도록 하였다.
#### - 그 다음으로는 포인트 기능을 구현하였다.
#### - 고민선택글과 고민상담방을 생성하여 서비스를 이용한 유저에게는 +3 포인트, 다른 유저가 작성한 고민선택글에 투표를 해준 유저에게는 +1 포인트가 지급될 수 있도록 만들고, 포인트 점수를 기준으로 등급을 만들어 등급별로 프로필 이미지에 들어갈 우리의 브랜드 아이템의 색상이 다르도록 하고자 했다!
#### - user 모델에 point column을 추가하였고, 선택글 및 상담방 생성 api안에 update를 통해 point +3점씩 적립될 수 있도록 하였다.
#### - 그리고 투표 api안에도 update를 통해 point +1점씩 적립될 수 있도록 하였고, 각 기능별로 포인트가 잘 누적되고 있음을 확인하였다!
#### - 이제 추후 우리의 마스코트 이미지가 정해진다면, 프론트에서 유저 포인트별로 마스코트의 색상별로 등급을 지정해줄 예정이다!
#### - 마지막으로 구글 소셜로그인!
#### - 카카오톡 소셜로그인에서 많은 우여곡절을 겪어서 구글 소셜로그인을 1시간만에 해결할 수 있었다~!
#### - 연결을 해보던 중 에러가 발생한 부분은 내가 코드에서 에러를 err에서 error로 통일하던 중 변경하지 않았던 부분이 발견되었고.. 그 부분을 수정하고, 프론트에서도 연결 코드를 다시 수정하니 로그인 기능이 잘 구현되었다!
#### - `역시.. 에러들을 많이 만나볼수록 해결 과정이 빨라진다..`

<br>

### `우리 반에서 우리 조가 소셜로그인을 가장 빨리 구현한 조였다. 그래서 다른 조에서 도움 요청이 많이 왔고, 우리가 겪었던 오류들을 공유하며 최대한 다른 조들은 조금 더 무난하게 해결해가실 수 있도록 도움을 드리고자 했다.`
### `그렇게 조금씩 프론트와-백이 연결되고, 해결되어가는 과정을 보며 내가 작게나마 도움이 되었다는 것에 대한 뿌듯함도 느꼈다~! 하지만, 내가 코드의 과정에 대해 조금 더 명확히 설명할 수 있었으면 상대방도 이해가 더 잘되었을텐데.. 라는 생각을 하였다.`
### `개념 정리의 필요성과 동료들과 함께 하는 코드리뷰를 통해 코드에 대해 명확하게 설명할 수 있게 해야겠다는 점을 느꼈다.`
### `2주차까지 모두 잠도 줄여가시며 열심히 하고 있는데, 우리 반 모두가 좋은 결과물을 만들어 함께 멋진 개발자가 되었으면 좋겠다~!`
